{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\n\nvar _this = this,\n    _jsxFileName = \"/Users/macbook/Documents/blog/pages/home.tsx\",\n    _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\nimport React, { useRef, useEffect, useContext } from \"react\";\nimport { usePosts } from \"~/services/posts\";\nimport CenterContent from \"~/components/shared/center-content\";\nimport HomeCenterComponent from \"~/components/home-page/home-center-component\";\nimport { Context } from \"~/context/context\";\n\nvar Home = function Home() {\n  _s();\n\n  var _ref = useContext(Context),\n      setAllPosts = _ref.setAllPosts,\n      postCount = _ref.postCount,\n      setPostCount = _ref.setPostCount;\n\n  var _usePosts = usePosts({\n    variables: {\n      page: postCount\n    }\n  }),\n      data = _usePosts.data,\n      isFetching = _usePosts.isFetching;\n\n  console.log(data, \"data\");\n  var ref = useRef(null);\n\n  var handleIntersection = function handleIntersection(entries) {\n    var entry = entries[0];\n\n    if (entry.isIntersecting && !isFetching) {\n      setPostCount(function (prevCount) {\n        return prevCount + 1;\n      });\n    }\n  };\n\n  useEffect(function () {\n    if (data) {\n      setAllPosts(function (prevPosts) {\n        return [].concat(_toConsumableArray(prevPosts), _toConsumableArray(data));\n      });\n    }\n  }, [data]);\n  useEffect(function () {\n    var options = {\n      root: null,\n      rootMargin: \"0px\",\n      threshold: 0.1\n    };\n    var observer = new IntersectionObserver(handleIntersection, options);\n\n    if (ref.current) {\n      observer.observe(ref.current);\n    }\n\n    return function () {\n      if (ref.current) {\n        observer.unobserve(ref.current);\n      }\n    };\n  }, [isFetching]);\n  return __jsx(\"main\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 54,\n      columnNumber: 9\n    }\n  }, __jsx(CenterContent, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 55,\n      columnNumber: 13\n    }\n  }, __jsx(HomeCenterComponent, {\n    childRef: ref,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 56,\n      columnNumber: 17\n    }\n  })));\n};\n\n_s(Home, \"DEn9mysOXLMHkztk3BNoiqhXjG8=\", false, function () {\n  return [usePosts];\n});\n\n_c = Home;\nexport var __N_SSG = true;\nexport default Home;\n\nvar _c;\n\n$RefreshReg$(_c, \"Home\");","map":{"version":3,"sources":["/Users/macbook/Documents/blog/pages/home.tsx"],"names":["React","useRef","useEffect","useContext","usePosts","CenterContent","HomeCenterComponent","Context","Home","setAllPosts","postCount","setPostCount","variables","page","data","isFetching","console","log","ref","handleIntersection","entries","entry","isIntersecting","prevCount","prevPosts","options","root","rootMargin","threshold","observer","IntersectionObserver","current","observe","unobserve"],"mappings":";;;;;;;AAAA,OAAOA,KAAP,IAAeC,MAAf,EAAuBC,SAAvB,EAAkCC,UAAlC,QAAmD,OAAnD;AAGA,SAAQC,QAAR,QAAuB,kBAAvB;AACA,OAAOC,aAAP,MAA0B,oCAA1B;AACA,OAAOC,mBAAP,MAAgC,8CAAhC;AAEA,SAAQC,OAAR,QAAsB,mBAAtB;;AAIA,IAAMC,IAAe,GAAG,SAAlBA,IAAkB,GAAM;AAAA;;AAAA,aACqBL,UAAU,CAACI,OAAD,CAD/B;AAAA,MAClBE,WADkB,QAClBA,WADkB;AAAA,MACNC,SADM,QACNA,SADM;AAAA,MACIC,YADJ,QACIA,YADJ;;AAAA,kBAECP,QAAQ,CAAC;AAChCQ,IAAAA,SAAS,EAAE;AAACC,MAAAA,IAAI,EAAEH;AAAP;AADqB,GAAD,CAFT;AAAA,MAEnBI,IAFmB,aAEnBA,IAFmB;AAAA,MAEbC,UAFa,aAEbA,UAFa;;AAK1BC,EAAAA,OAAO,CAACC,GAAR,CAAYH,IAAZ,EAAiB,MAAjB;AACA,MAAMI,GAAG,GAAGjB,MAAM,CAAwB,IAAxB,CAAlB;;AAEA,MAAMkB,kBAAkB,GAAG,SAArBA,kBAAqB,CAACC,OAAD,EAA0C;AACjE,QAAMC,KAAK,GAAGD,OAAO,CAAC,CAAD,CAArB;;AACA,QAAIC,KAAK,CAACC,cAAN,IAAwB,CAACP,UAA7B,EAAyC;AACrCJ,MAAAA,YAAY,CAAC,UAACY,SAAD;AAAA,eAAeA,SAAS,GAAG,CAA3B;AAAA,OAAD,CAAZ;AACH;AACJ,GALD;;AAOArB,EAAAA,SAAS,CAAC,YAAM;AACZ,QAAIY,IAAJ,EAAU;AACNL,MAAAA,WAAW,CAAC,UAACe,SAAD;AAAA,4CAAmBA,SAAnB,sBAAiCV,IAAjC;AAAA,OAAD,CAAX;AACH;AACJ,GAJQ,EAIN,CAACA,IAAD,CAJM,CAAT;AAMAZ,EAAAA,SAAS,CAAC,YAAM;AACZ,QAAMuB,OAAO,GAAG;AACZC,MAAAA,IAAI,EAAE,IADM;AAEZC,MAAAA,UAAU,EAAE,KAFA;AAGZC,MAAAA,SAAS,EAAE;AAHC,KAAhB;AAKA,QAAMC,QAAQ,GAAG,IAAIC,oBAAJ,CAAyBX,kBAAzB,EAA6CM,OAA7C,CAAjB;;AAEA,QAAIP,GAAG,CAACa,OAAR,EAAiB;AACbF,MAAAA,QAAQ,CAACG,OAAT,CAAiBd,GAAG,CAACa,OAArB;AACH;;AAED,WAAO,YAAM;AACT,UAAIb,GAAG,CAACa,OAAR,EAAiB;AACbF,QAAAA,QAAQ,CAACI,SAAT,CAAmBf,GAAG,CAACa,OAAvB;AACH;AACJ,KAJD;AAMH,GAlBQ,EAkBN,CAAChB,UAAD,CAlBM,CAAT;AAoBA,SACI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACI,MAAC,aAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACI,MAAC,mBAAD;AAAqB,IAAA,QAAQ,EAAEG,GAA/B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADJ,CADJ,CADJ;AAOH,CAhDD;;GAAMV,I;UAEyBJ,Q;;;KAFzBI,I;;AAkEN,eAAeA,IAAf","sourcesContent":["import React, {useRef, useEffect, useContext} from \"react\";\nimport {QueryClient} from \"react-query\";\nimport {dehydrate} from \"react-query/hydration\";\nimport {usePosts} from \"~/services/posts\";\nimport CenterContent from \"~/components/shared/center-content\";\nimport HomeCenterComponent from \"~/components/home-page/home-center-component\";\nimport {INextPage} from \"~/types/INextPage\";\nimport {Context} from \"~/context/context\";\nimport {ContextType} from \"~/types/static\";\n\nconst POST_COUNT = 1\nconst Home: INextPage = () => {\n    const { setAllPosts,postCount,setPostCount } = useContext(Context) as ContextType;\n    const {data, isFetching} = usePosts({\n        variables: {page: postCount},\n    });\n    console.log(data,\"data\")\n    const ref = useRef<HTMLDivElement | null>(null);\n\n    const handleIntersection = (entries: IntersectionObserverEntry[]) => {\n        const entry = entries[0];\n        if (entry.isIntersecting && !isFetching) {\n            setPostCount((prevCount) => prevCount + 1);\n        }\n    };\n\n    useEffect(() => {\n        if (data) {\n            setAllPosts((prevPosts) => [...prevPosts, ...data]);\n        }\n    }, [data]);\n\n    useEffect(() => {\n        const options = {\n            root: null,\n            rootMargin: \"0px\",\n            threshold: 0.1,\n        };\n        const observer = new IntersectionObserver(handleIntersection, options);\n\n        if (ref.current) {\n            observer.observe(ref.current);\n        }\n\n        return () => {\n            if (ref.current) {\n                observer.unobserve(ref.current);\n            }\n        };\n\n    }, [isFetching]);\n\n    return (\n        <main>\n            <CenterContent>\n                <HomeCenterComponent childRef={ref}/>\n            </CenterContent>\n        </main>\n    );\n};\n\nexport async function getStaticProps() {\n    const queryClient = new QueryClient();\n\n    await queryClient.prefetchQuery(\n        usePosts.getKey({page: POST_COUNT}),\n        usePosts.queryFn\n    );\n    console.log(queryClient)\n    return {\n        props: {\n            dehydratedState: dehydrate(queryClient),\n        },\n        unstable_revalidate: 60,\n    };\n}\n\nexport default Home;\n\n\n\n\n"]},"metadata":{},"sourceType":"module"}